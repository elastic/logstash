---
name: Update logstash version files
pipelineid: "logstash/version-updates"

scms:
  default:
    kind: github
    spec:
      user: '{{ requiredEnv "GITHUB_ACTOR" }}'
      username: '{{ requiredEnv "GITHUB_ACTOR" }}'
      owner: '{{ .scm.owner }}'
      repository: '{{ .scm.repository }}'
      token: '{{ requiredEnv "GITHUB_TOKEN" }}'
      branch: '{{ requiredEnv "LOGSTASH_BRANCH" }}'
      commitusingapi: true
      force: false

actions:
  default:
    title: 'Bump logstash version {{ requiredEnv "LOGSTASH_VERSION" }}'
    kind: github/pullrequest
    spec:
      automerge: false
      labels:
      - automation
      description: |-
        ### What
        Update logstash version in versions.yml

targets:
  update_logstash_version:
    name: Update logstash version in versions.yml
    kind: yaml
    disablesourceinput: true
    spec:
      file: versions.yml
      key: $.logstash
      value: '{{ requiredEnv "LOGSTASH_VERSION" }}'
  
  update_logstash_core_version:
    name: Update logstash-core version in versions.yml
    kind: yaml
    disablesourceinput: true
    spec:
      file: versions.yml
      key: $.logstash-core
      value: '{{ requiredEnv "LOGSTASH_VERSION" }}'