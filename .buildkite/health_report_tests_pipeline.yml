# yaml-language-server: $schema=https://raw.githubusercontent.com/buildkite/pipeline-schema/main/schema.json

agents:
  image: "docker.elastic.co/ci-agent-images/platform-ingest/buildkite-agent-logstash-ci"
  cpu: "2"
  memory: "4Gi"
  ephemeralStorage: "64Gi"

steps:
  # todo: add a step for 8.latest when Health Report MVP is landed
  - label: ":logstash: Health Report Integration tests on main branch."
    command: |
      echo "--- Installing dependencies"
      python3 -m pip install -r .buildkite/scripts/health-report-tests/requirements.txt
      echo "--- running tests"
      python3 .buildkite/scripts/health-report-tests/main.py
    retry:
      automatic:
        - limit: 3
