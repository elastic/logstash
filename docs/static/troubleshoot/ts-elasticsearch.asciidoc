[[ts-elasticsearch]]
==== Elasticsearch issues and solutions

[discrete]
[[ts-elasticsearch-409]]
===== Elasticsearch rejects documents with `version_conflict_engine_exception`

*Symptoms*

When elastic-agent transmits events to {ls} and {ls} to {es} with <<plugins-outputs-elasticsearch,{es} output plugin>>, {es} may reject documents with `version_conflict_engine_exception` exception.
The logs may look like as follows:

-----
[2024-04-24T14:13:25,988][WARN ][logstash.outputs.elasticsearch][elastic-agent-to-logstash].[abcde1234...] Failed action {:status=>409,
:action=>["create", {:_id=>nil, :_index=>"metrics-windows.service-default", :routing=>nil}, {"host"=>{"mac"=>["...", "..."], "name"=>"redacted-name",
"ip"=>[...], "architecture"=>"x86_64", "id"=>"aae15", "os"=>{"name"=>"Windows Server 2016 Datacenter", "platform"=>"windows", "type"=>"windows",
"kernel"=>"10.0.14393.6897 (rs1_release.240404-1613)", "family"=>"windows", "build"=>"14393.6897", "version"=>"10.0"},
"hostname"=>"redacted-host"}, "service"=>{"type"=>"windows"}, "elastic_agent"=>{"version"=>"8.11.3",
"id"=>"48423d1c-5a87-46ef-b6a8-baf90b515e63", "snapshot"=>false}, "metricset"=>{"name"=>"service", "period"=>60000},
"event"=>{"duration"=>211345500, "module"=>"windows", "dataset"=>"windows.service"}, "cloud"=>{"service"=>{"name"=>"redacted-name"},
"instance"=>{"id"=>"redacted-id", "name"=>"redacted-name"}, "provider"=>"provider", "machine"=>{"type"=>"t"},
"availability_zone"=>"zone"}, "@timestamp"=>2024-04-24T14:12:24.991Z, ...., "type"=>"metricbeat",
"id"=>"48423d1c-5a87-46ef-b6a8-baf90b515e63", "ephemeral_id"=>"fdd26638-3865-4e63-961a-69d8f419538a", "version"=>"8.11.3"},
"@version"=>"1"}], :response=>{"create"=>{"status"=>409, "error"=>{"type"=>"version_conflict_engine_exception",
"reason"=>"[abcd][{agent.id=my-agent-id, cloud.availability_zone=zone, cloud.instance.id=i-id, windows.service.pid=996,
windows.service.state=Running}@2024-04-24T14:12:24.991Z]: version conflict, document already exists (current version [1])",
"index_uuid"=>"wBkYL16ZSo2fJ7tAC3zbbw", "shard"=>"0", "index"=>".ds-metrics-windows.service-default-2024.04.22-000065"}}}}
-----

*Background*

Should cover:

- 409 issue with time series index
- 409 issue with integrations include fingerprint processor to calculate document `_id`
