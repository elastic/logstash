[[monitoring-with-elastic-agent]]
=== Collect {ls} monitoring data with {agent}
[subs="attributes"]
++++
<titleabbrev>{agent} collection</titleabbrev>
++++

You can use {agent} to collect data about {ls} and ship it to the monitoring
cluster. The benefit of {agent} collection is that the monitoring agent remains
active even if the {ls} instance does not. Plus you can manage all your
monitoring agents from a central location in {fleet}.

To collect and ship monitoring data:

. <<disable-default-include,Disable default collection of monitoring metrics>>
. <<define-cluster__uuid-include,Specify the target `cluster_uuid` (optional)>>
. <<configure-metricbeat,Install and configure {agent} to collect monitoring data>>

[float]
[[disable-default-include]]
//include section about disabling default collection from the metricbeat topic
include::monitoring-mb.asciidoc[tag=disable-default-collection]

[float]
[[define-cluster__uuid-include]]
//include section about defining cluster_uuid from the metricbeat topic
include::monitoring-mb.asciidoc[tag=define-cluster-uuid]

[float]
[[configure-elastic-agent-logstash-dashboards]]

== Install and configure {agent}


[discrete]
[[add-logstash-integration]]
=== Step 1: Add the {agent} Logstash integration

{agent} is a single, unified way to add monitoring for logs, metrics, and other
types of data to a host. Each agent has a single policy you can update to add
integrations for new data sources, security protections, and more.

In this step, add the {ls} integration to monitor host logs and metrics.

. Go to the {kib} home page and click **Add integrations**.
+
--
[role="screenshot"]
image::images/kibana-home.png[{kib} home page]
--

. In the query bar, search for **Logstash** and select the integration to see more
details about it.

. Click **Add Logstash**.

. Configure the integration name and optionally add a description.

[[configure-logstash-logs]]
==== Configure {agent} to collect {ls} Logs

Make sure that **Logs** is turned on.

--
[role="screenshot"]
image::images/integration-configure-logs.png[{kib} home page]
--

. Make sure you configure all required settings:
* Under **Logs**, modify the log paths
to match your {ls} environment.

[[configure-logstash-stack-monitoring]]
==== Configure {agent} with Stack Monitoring

Make sure that **Metrics (Stack Monitoring)** is turned on, and **Metrics (Technical Preview)** is turned off.


--
[role="screenshot"]
image::images/integration-configure-stack-monitoring.png[{kib} home page]
--

* Under **Metrics (Stack Monitoring)**, make sure the hosts setting
points to your {ls} host URLs. By default, the integration collects {ls}
monitoring metrics from `localhost:9600`. If that host and port number are not
correct, update the `hosts` setting. If you configured {ls} to use encrypted
communications, you must access it via HTTPS. For example, use a `hosts` setting
like
`https://localhost:9600`.

[[configure-logstash-dashboards]]
==== Configure {agent} with Logstash Dashboards (Technical Preview)

Make sure that **Metrics (Technical Preview)** is turned on, and **Metrics (Stack Monitoring)** is turned off.


--
[role="screenshot"]
image::images/integration-configure-tech-preview.png[Configuration page for adding log paths to the {agent} System integration]
--


* Under **Metrics (Technical Preview)**, make sure the Logstash URL setting
points to your {ls} instance URLs. By default, the integration collects {ls}
monitoring metrics from `https://localhost:9600`. If that host and port number are not
correct, update the `Logstash URL` setting. If you configured {ls} to use encrypted
communications and/or a username and password, you must access it via HTTPS, and expand the **Advanced Settings** options, and fill in with the appropriate values for your {ls} instance.


. Click **Save and continue**. This step takes a minute or two to complete. When
it's done, you'll have an agent policy that contains a system integration policy
for the configuration you just specified.
+
--
[role="screenshot"]
image::images/integration-configure-save.png[Configuration page for adding the {agent} System integration]
--

. In the popup, click **Add {agent} to your hosts** to open the **Add agent**
flyout.
+
TIP: If you accidentally close the popup, go to **{fleet} > Agents**, then click
**Add agent** to access the flyout.

[discrete]
[[add-agent-to-fleet]]
=== Step 2: Install and run an {agent} on your machine

The **Add agent** flyout has two options: **Enroll in {fleet}** and
**Run standalone**. The default is to enroll the agents in {fleet}, as this
reduces the amount of work on the person managing the hosts by providing
a centralized management tool in {kib}.

. Skip the **Select enrollment token** step. The enrollment token you need is
already selected.
+
NOTE: The enrollment token is specific to the {agent} policy that you just
created. When you run the command to enroll the agent in {fleet}, you will pass
in the enrollment token.

. Download, install, and enroll the {agent} on your host by selecting
your host operating system and following the **Install {agent} on your host**
step.
+
--
[role="screenshot"]
image::images/integration-agent-add.png[Add agent flyout in {kib}]
--

It takes about a minute for {agent} to enroll in {fleet}, download the
configuration specified in the policy you just created, and start collecting
data.


--
[role="screenshot"]
image::images/integration-agent-confirm.png[Agent confirm data]
--

* Once enrollment is confirmed and incoming data is received,  click **View assets** to access dashboards related to the Logstash integration.
* For traditional Stack Monitoring UI, the dashboards marked **[Logs Logstash]** are used to visualize the logs
produced by your Logstash Instances, with those marked **[Metrics Logstash]** for the technical preview metrics
dashboards.
** Note that these will only be populated with data if the **Metrics (Technical Preview)** checkbox was
selected.

--
[role="screenshot"]
image::images/integration-assets-dashboards.png[Integration assets]
--

A number of dashboards are included to view Logstash as a whole, and dashboards that allow you to drill-down
into how Logstash is performing on a node, pipeline and plugin basis.


[discrete]
[[view-data-stack-monitoring]]
=== Step 3: Monitor Logstash logs and metrics (Stack Monitoring)

{kibana-ref}/monitoring-data.html[View the monitoring data in {kib}], and navigate to the <<logstash-monitoring-ui, {monitoring} UI>>

[discrete]
[[view-data-dashboard]]
=== Step 3: Monitor Logstash logs and metrics (Logstash Metrics Dashboard Technical Preview)




. From the list of assets, open the **[Metrics Logstash] Logstash overview** dashboard to view overall performance. Then follow the navigation panel to further drill down into Logstash performance.
+
[role="screenshot"]
image::images/integration-dashboard-overview.png[The Logstash Overview dashboard in {kib} with various metrics from your monitored Logstash]

You can hover over any visualization to adjust its settings, or click the
**Edit** button to make changes to the dashboard. To learn more, refer to
{kibana-ref}/dashboard.html[Dashboard and visualizations].
