[[monitoring-with-elastic-agent]]
=== Collect {ls} monitoring data for stack monitoring
[subs="attributes"]
++++
<titleabbrev>Collect monitoring data for stack monitoring</titleabbrev>
++++

ToDo: Add brief intro describing the feature and value prop. 
So far, we haven't differentiated between the two. 
Add info to help them decide which one they want to use.  

When you have completed the <<monitoring-prereqs>>, install and configure {agent} to monitor host logs and metrics.
We'll walk you through the process in these steps:

. <<add-logstash-integration-ea>>
. <<add-agent-to-fleet-ea>>
. <<confirm-ea>>
. <<view-data-stack>>

[discrete]
[[add-logstash-integration-ea]]
==== Add the {agent} {ls} integration

. Go to the {kib} home page, and click **Add integrations**.
+
--
[role="screenshot"]
image::images/kibana-home.png[{kib} home page]
--

. In the query bar, search for **Logstash** and select the integration to see more
details about it.

. Click **Add {ls}**.

. Configure the integration name and optionally add a description.

. Configure the integration to collect logs.
* Make sure that **Logs** is turned on if you want to collect logs from your {ls} instance, ensuring that the required settings are correctly configured:
* Under **Logs**, modify the log paths
to match your {ls} environment.

. Configure the integration to collect metrics
* Make sure that **Metrics (Stack Monitoring)** is turned on, and **Metrics (Technical Preview)** is turned off, if you
want to collect metrics from your Logstash instance
* Under **Metrics (Stack Monitoring)**, make sure the hosts setting
points to your {ls} host URLs. By default, the integration collects {ls}
monitoring metrics from `localhost:9600`. If that host and port number are not
correct, update the `hosts` setting. If you configured {ls} to use encrypted
communications, you must access it via HTTPS. For example, use a `hosts` setting
like
`https://localhost:9600`.

. Choose where to add the integration policy. +
Click **New hosts** to add it to new agent policy or **Existing hosts** to add it to an existing agent policy.
. In the popup, click **Add {agent} to your hosts** to open the **Add agent**
flyout.
+
TIP: If you accidentally close the popup, go to **{fleet} > Agents**, then click
**Add agent** to access the flyout.

[discrete]
[[add-agent-to-fleet-ea]]
==== Install and run an {agent} on your machine
// Include section about installing agents
include::monitoring-install.asciidoc[tag=install-agent-widget]

[discrete]
[[confirm-ea]]
=== Confirm Enrollment
// Include section about confirming enrollment
include::monitoring-confirm.asciidoc[tag=confirm-enrollment-widget]

[discrete]
[[view-data-stack]]
==== Monitor Logstash logs and metrics (Stack Monitoring)

{kibana-ref}/monitoring-data.html[View the monitoring data in {kib}], and navigate to the <<logstash-monitoring-ui, monitoring UI>>.
