[[releasenotes]]
== Release Notes

This section summarizes the changes in the following releases:

* <<logstash-6-3-1,Logstash 6.3.1>>
* <<logstash-6-3-0,Logstash 6.3.0>>
* <<logstash-6-2-4,Logstash 6.2.4>>
* <<logstash-6-2-3,Logstash 6.2.3>>
* <<logstash-6-2-2,Logstash 6.2.2>>
* <<logstash-6-2-1,Logstash 6.2.1>>
* <<logstash-6-2-0,Logstash 6.2.0>>
* <<logstash-6-1-3,Logstash 6.1.3>>
* <<logstash-6-1-2,Logstash 6.1.2>>
* <<logstash-6-1-1,Logstash 6.1.1>>
* <<logstash-6-1-0,Logstash 6.1.0>>

[[logstash-6-3-1]]
=== Logstash 6.3.1 Release Notes

* Adds a Persistent Queue repair utility, enabling self-recovery of corrupted PQs ({lsissue}9710[Issue 9710]).
* Fixes two separate issues in Experimental Java Execution mode where complex pipeline configurations could fail to compile ({lsissue}9747[Issue 9747], {lsissue}9745[Issue 9745]).
* Fixes issue when running Logstash inside of a Docker container with Persistent Queue enabled where we incorrectly reported that there was insufficient space to allocate for the queue ({lsissue}9766[Issue 9766]).
* Fixes issue in x-pack monitoring where `queue_push_duration_in_millis` was incorrectly reporting _nanoseconds_ ({lsissue}9744[Issue 9744]).
* Fixes an issue where Logstash could fail to start when its `path.data` is a symlink ({lsissue}9706[Issue 9706]).
* Fixes issue with Netflow module where it could fail to populate `[geoip_dst][autonomous_system]` ({lsissue}9638[Issue 9638]).
* Fixes a potential conflict with plugin depenencies that require Guava by explicitly loading Guava 22 ({lsissue}9592[Issue 9592]).

[float]
==== Plugins

*Netflow Codec*

* Fixes exception when receiving Netflow 9 from H3C devices.
* Added support for Netflow 9 from H3C devices.
* Fixes incorrect definitions of IE 231 and IE 232.
* Fixes exceptions due to concurrent access of IPFIX templates.
* Added support for Netflow 9 reduced-size encoding support.
* Added support for Barracuda IPFIX Extended Uniflow.

*Beats Input*

* Fixes an issue that prevented auto-recovery in certain failure modes.
* Fixes an issue where trace-level logging omitted helpful context.

*Kafka Input*

* Fix race-condition where shutting down a Kafka Input before it completes startup could cause Logstash to crash.
* Upgrade Kafka client to version 1.1.0.

*S3 Input*

* Avoid plugin crashes when encountering 'bad' files in S3 buckets.
* Log entry when bucket is empty.
* Fixes `additional_settings` configuration option to properly symbolize keys for downstream library.

*TCP Input*

* New configuration option to set TCP keep-alive.
* Fixes an issue where the input could crash during shutdown, affecting pipeline reloads.

*UDP Input*

* Mitigate memory leak in JRuby's UDP implementation.

*DNS Filter*

* Log timeouts as warn instead of error.
* Allow concurrent queries when cache enabled.

*Elasticsearch Filter*

* Fix: The filter now only calls filter_matched on events that actually matched. This fixes issues where all events would have success-related actions happened when no match had actually happened (`add_tag`, `add_field`, `remove_tag`, `remove_field`).

*JDBC Static Filter*

* Fixed an issue where failing to specify `index_columns` would result in an obscure error message.

*KV Filter*

* improves `trim_key` and `trim_value` to trim any _sequence_ of matching characters from the beginning and ends of the corresponding keys and values; a previous implementation limited trim to a single character from each end, which was surprising.
* fixes issue where we can fail to correctly break up a sequence that includes a partially-quoted value followed by another fully-quoted value by slightly reducing greediness of quoted-value captures.

*Mutate Filter*

* Fix: when converting to `float` and `float_eu`, explicitly support same range of inputs as their integer counterparts.

*Elasticsearch Output*

* Added support for customizing HTTP headers.
* Log an error -- not a warning -- when ES raises an invalid_index_name_exception.
* Improve plugin behavior when Elasticsearch is down on startup.

*File Output*

* Fix a bug where flush interval was being called for each event when enabled

*Kafka Output*

* Changed Kafka send errors to log as warn.
* Upgrade Kafka client to version 1.1.0.

*S3 Output*

* Fixes `additional_settings` configuration option to properly symbolize keys for downstream library.

*SQS Output*

* Added the ability to send to a different account id's queue.

[[logstash-6-3-0]]
=== Logstash 6.3.0 Release Notes

[IMPORTANT]
--
Persistent Queue users must upgrade. Old data will not be compatible with 6.3.0, and must be migrated or deleted. Read
{logstash-ref}/upgrading-logstash-pqs.html[Upgrading Persistent Queue from Logstash 6.2.x and Earlier]
for more information.
--

* BUGFIX: Fix race condition in shutdown of pipelines https://github.com/elastic/logstash/pull/9285[#9285]
* BUGFIX: Ensure atomic creation of persistent queue checkpoints https://github.com/elastic/logstash/pull/9303[#9303]
* BUGFIX: Fixed issue where events containing non-ASCII characters were getting encoded incorrectly after passing through the persistent queue https://github.com/elastic/logstash/pull/9307[#9307]
* BUGFIX: Fixes incorrect serialization of strings extracted from other strings via substring, regex matching, etc. https://github.com/elastic/logstash/pull/9308[#9308]
* BUGFIX: Fixes nested metadata field lookup in Java execution https://github.com/elastic/logstash/pull/9297[#9297]
* BUGFIX: Persistent queue must allow reading empty batches https://github.com/elastic/logstash/pull/9328[#9328]
* BUGFIX: Prevents pipelines.yml from being overwritten during RPM/DEB package upgrade https://github.com/elastic/logstash/pull/9130[#9130]
* BUGFIX: Different types of values for the `ssl.enabled` module option are now tolerated https://github.com/elastic/logstash/pull/8600[#8600]
* BUGFIX: Detect invalid proxy and raise error https://github.com/elastic/logstash/pull/9230[#9230]
* BUGFIX: Fix `Logstash::Util.deep_clone` for `LogStash::Timestamp` https://github.com/elastic/logstash/pull/9405[#9405]
* BUGFIX: Better error message for temp directory errors https://github.com/elastic/logstash/pull/9293[#9293]
* BUGFIX: Better error message when `Event#set` is called on non-collection nested field https://github.com/elastic/logstash/pull/9298[#9298]
* Implemented upgrade to persistent queues v2 https://github.com/elastic/logstash/pull/9538[#9538]
* Inter-pipeline communication (within multiple pipelines on a single Logstash node) https://github.com/elastic/logstash/pull/9225[#9225]
* Speed up pipeline compilation https://github.com/elastic/logstash/pull/9278[#9278]
* Added bootstrap checks for available disk space when persistent queue is enabled https://github.com/elastic/logstash/pull/8978[#8978]
* Made `-V`/`--version` fast on Windows https://github.com/elastic/logstash/pull/8508[#8508]
* Start web server after pipeline https://github.com/elastic/logstash/pull/9398[#9398]
* Optimize out empty `if` conditions from execution graph https://github.com/elastic/logstash/pull/9314[#9314]

==== Plugins
*Netflow Codec*

* Added support for IPFIX from Procera/NetIntact/Sandvine 15.1 https://github.com/logstash-plugins/logstash-codec-netflow/pull/131[#131]

*JDBC_static Filter*

* Support multiple driver libraries https://github.com/logstash-plugins/logstash-filter-jdbc_static/issues/22[#22]
* Use Java classloader to load driver jar. Use system import from file to loader local database. Prevent locking errors when no records returned. https://github.com/logstash-plugins/logstash-filter-jdbc_static/issues/18[#18], https://github.com/logstash-plugins/logstash-filter-jdbc_static/issues/17[#17], https://github.com/logstash-plugins/logstash-filter-jdbc_static/issues/12[#12]
* `loader_schedule` now works as designed https://github.com/logstash-plugins/logstash-filter-jdbc_static/issues/8[#8]

*UDP Input*

* Fix missing require for the ipaddr library https://github.com/logstash-plugins/logstash-input-udp/pull/37[#37]

[[logstash-6-2-4]]
=== Logstash 6.2.4 Release Notes

* Fixed an issue where events passing through the persistent queue had the contents of string type fields corrupted for values containing non-ASCII characters. The solution involved serializing the RubyString as Java String UTF-16 encoded https://github.com/elastic/logstash/pull/9167[#9167]
* Fixed serialization bug when a RubyString that comes out of a matching, substring or similar operation may not have offset 0 pointing at the underlying BytesList. Solved by serializing the correct part of the BytesList https://github.com/elastic/logstash/pull/9308[#9308]
* Improved performance of Event#cancel, where each operation would unnecessarily generate a new object. In configurations that use plugins like the `drop filter` throughput may increase up to 5x https://github.com/elastic/logstash/pull/9284[#9284]
* Fixed an issue with type handling in metadata fields. Before this a plugin could trigger a Java exception when placing data into an event's metadata https://github.com/elastic/logstash/pull/9299[#9299]
* Fixed a race condition in shutdown of pipelines where not all workers would consume a single SHUTDOWN signal https://github.com/elastic/logstash/pull/9285[#9285]
* Multiple documentation improvements relating to configuration files, JVM options, default plugin codecs, Logstash-to-Logstash communication and Keystore.

==== Plugins

*Json_lines Codec*

* Support flush method, see https://github.com/logstash-plugins/logstash-codec-json_lines/pull/35

*Netflow Codec*

* Workaround for breaking change in Netflow-Input-UDP > 3.2.0, see issue https://github.com/logstash-plugins/logstash-codec-netflow/issues/122[#122]
* Renamed some unknown VMware VDS fields

*Aggregate Filter*

* new feature: add 'timeout_timestamp_field' option.
  When set, this option computes timeout based on event timestamp field (and not system time). It's particularly useful when processing old logs.
* new feature: add 'inactivity_timeout' option.
  Events for a given `task_id` will be aggregated for as long as they keep arriving within the defined `inactivity_timeout` option - the inactivity timeout is reset each time a new event happens. On the contrary, `timeout` is never reset and happens after `timeout` seconds since aggregation map creation.

*Dns Filter*

* Logging improvement to include DNS resolution failure reason https://github.com/logstash-plugins/logstash-filter-dns/issues/36[#36]
* Fix bug where forward lookups would not cache timeout errors

*Jdbc_streaming Filter*

* Load the driver with the system class loader. Fixes issue loading some JDBC drivers in Logstash 6.2+ https://github.com/logstash-plugins/logstash-input-jdbc/issues/263[#263]

*Kv Filter*

* Correctly handle empty values between value separator and field separator https://github.com/logstash-plugins/logstash-filter-kv/issues/58[#58]

*Ruby Filter*

* Fix return of multiple events when using file based scripts https://github.com/logstash-plugins/logstash-filter-ruby/issues/41[#41]

*Translate Filter*

* Add 'refresh_behaviour' to either 'merge' or 'replace' during a refresh https://github.com/logstash-plugins/logstash-filter-translate/issues/57[#57]

*Beats Input*

* Ensure that the keep-alive is sent for ALL pending batches when the pipeline is blocked, not only the batches attempting to write to the queue. https://github.com/logstash-plugins/logstash-input-beats/issues/310[#310]

*Exec Input*

* Add metadata data to the event wrt execution duration and exit status
* Add 'schedule' option to schedule the command to run, using a cron expression

*Http Input*

* Make sure default codec is also cloned for thread safety. https://github.com/logstash-plugins/logstash-input-http/pull/80[#80]
* Always flush codec after each request and codec decoding. https://github.com/logstash-plugins/logstash-input-http/pull/81[#81]

*Jdbc Input*

* Clarify use of use_column_value. Make last_run_metadata_path reference in record_last_run entry clickable. https://github.com/logstash-plugins/logstash-input-jdbc/issues/273[#273]
* Load the driver with the system class loader. Fixes issue loading some JDBC drivers in Logstash 6.2+ https://github.com/logstash-plugins/logstash-input-jdbc/issues/263[#263]
* Fix regression with 4.3.5 that can result in NULL :sql_last_value depending on timestamp format https://github.com/logstash-plugins/logstash-input-jdbc/issues/274[#274]

*Redis Input*

* Add support for SSL https://github.com/logstash-plugins/logstash-input-redis/issues/61[#61]
* Add support for Redis unix sockets https://github.com/logstash-plugins/logstash-input-redis/issues/64[#64]

*S3 Input*

* Improve error handling when listing/downloading from S3 https://github.com/logstash-plugins/logstash-input-s3/issues/144[#144]
* Add documentation for endpoint, role_arn and role_session_name https://github.com/logstash-plugins/logstash-input-s3/issues/142[#142]
* Add support for additional_settings option https://github.com/logstash-plugins/logstash-input-s3/issues/141[#141]

*Sqs Input*

* Add documentation for endpoint, role_arn and role_session_name https://github.com/logstash-plugins/logstash-input-sqs/issues/46[#46]
* Fix sample IAM policy to match to match the documentation https://github.com/logstash-plugins/logstash-input-sqs/issues/32[#32]

*Tcp Input*

* Restore SSLSUBJECT field when ssl_verify is enabled. https://github.com/logstash-plugins/logstash-input-tcp/issues/115[#115]
* Update Netty/tc-native versions to match those in beats input https://github.com/logstash-plugins/logstash-input-tcp/issues/113[#113]

*Udp Input*

* Add metrics support for events, operations, connections and errors produced during execution. https://github.com/logstash-plugins/logstash-input-udp/issues/34[#34]
* Fix support for IPv6 https://github.com/logstash-plugins/logstash-input-udp/issues/31[#31]

*Aws Mixin*

* Drop strict value validation for region option https://github.com/logstash-plugins/logstash-mixin-aws/issues/36[#36]
* Add endpoint option to customize the endpoint uri https://github.com/logstash-plugins/logstash-mixin-aws/issues/32[#32]
* Allow user to provide a role to assume https://github.com/logstash-plugins/logstash-mixin-aws/issues/27[#27]
* Update aws-sdk dependency to '~> 2'

*Elasticsearch Output*

* Set number_of_shards to 1 and document_type to '_doc' for es 7.x clusters #741 https://github.com/logstash-plugins/logstash-output-elasticsearch/issues/747[#747]
* Fix usage of upsert and script when update action is interpolated https://github.com/logstash-plugins/logstash-output-elasticsearch/issues/239[#239]
* Add metrics to track bulk level and document level responses https://github.com/logstash-plugins/logstash-output-elasticsearch/issues/585[#585]

*File Output*

* Add feature `write_behavior` to the documentation https://github.com/logstash-plugins/logstash-output-file/issues/58[#58]

*S3 Output*

* Add documentation for endpoint, role_arn and role_session_name https://github.com/logstash-plugins/logstash-output-s3/issues/174[#174]
* Add option for additional settings https://github.com/logstash-plugins/logstash-output-s3/issues/173[#173]
* Add more S3 bucket ACLs https://github.com/logstash-plugins/logstash-output-s3/issues/158[#158]
* Handle file not found exception on S3 upload https://github.com/logstash-plugins/logstash-output-s3/issues/144[#144]
* Document prefix interpolation https://github.com/logstash-plugins/logstash-output-s3/issues/154[#154]

*Sqs Output*

* Add documentation for endpoint, role_arn and role_session_name https://github.com/logstash-plugins/logstash-output-sqs/issues/29[#29]

[[logstash-6-2-3]]
=== Logstash 6.2.3 Release Notes

* There are no changes to Logstash core in this release

==== Plugins

*Fluent codec*

* Added ability to encode tags as fluent forward protocol tags

*Netflow codec*

* Improved decoding performance of ASA ACL ids, MAC addresses and IPv4 addresses

*KV Filter*

* Added option to split fields and values using a regex pattern (#55)

*Mutate Filter*

* Introduced support for number strings using a decimal comma (e.g. 1,23), added convert support to specify integer_eu and float_eu

*Beats Input*

* Improved memory management and back pressure handling

*JDBC Input*

* Added fixes for thread and memory leak

*Syslog Input*

* Changed syslog field to be a configurable option. This is useful for when codecs change the field containing the syslog data.

*Elasticsearch Output*

* Changed sniffing behavior to connect only to `http.enabled` nodes that serve data for Elasticsearch 5.x and 6.x. Master-only nodes are ignored.
  (For Elasticsearch 1.x and 2.x, any nodes with `http.enabled` are added to the hosts lists, including master-only nodes.)

[[logstash-6-2-2]]
=== Logstash 6.2.2 Release Notes

* Fix issue introduced in 6.2.1 where `bin/logstash-plugin` could not install or upgrade plugins

[[logstash-6-2-1]]
=== Logstash 6.2.1 Release Notes

* There are no user facing changes in this release


[[logstash-6-2-0]]
=== Logstash 6.2.0 Release Notes

* Added support to protect sensitive settings and configuration in a {logstash-ref}/keystore.html[keystore].
* Added the {logstash-ref}/plugins-filters-jdbc_static.html[jdbc_static filter] as a default plugin.
* Set better defaults to allow for higher throughput under load. (https://github.com/elastic/logstash/issues/8707[#8707] and https://github.com/elastic/logstash/issues/8702[#8702])
* Set the default configuration for RPM/DEB/Docker installations to use {logstash-ref}/multiple-pipelines.html[Multiple pipelines].
* Added a default max size value (100MB) for log files.
* Added compression when log files are rolled (for ZIP-based installs).
* Added the ability to specify `--pipeline.id` from the command line. (https://github.com/elastic/logstash/issues/8868[#8868])
* Implemented continued improvements to the next generation of execution. Give it a try with the command line switch `--experimental-java-execution`.

==== Plugins

*Jdbc_static Filter*

* Released the initial version the {logstash-ref}/plugins-filters-jdbc_static.html[jdbc_static filter], which enriches events with data pre-loaded from a remote database.

*Dissect Filter*

* Fixed multiple bugs. See the plugin release notes for https://github.com/logstash-plugins/logstash-filter-dissect/blob/master/CHANGELOG.md#113[1.1.3].

*Grok Filter*

* Fixed a thread leak that occurred when Logstash was reloaded.

*Kafka Output*

* Improved error logging for when a producer cannot be created.

[[logstash-6-1-3]]
=== Logstash 6.1.3 Release Notes

* Fix bug where with terminating input plugins in-memory queue might not be drained. This could happen in some situations with inputs like the stdin input or the Elasticsearch input. This could result in some messages not being processed.
* Correctly handle paths with spaces on Windows. See https://github.com/elastic/logstash/pull/8931[#8931] for details.

==== Plugins

*Multiline Codec*

* Fixed concurrency issue causing random failures when multiline codec was used together with a multi-threaded input plugin

*CSV Filter*

* Added support for tagging empty rows which users can reference to conditionally drop events

*Elasticsearch Filter*

* If elasticsearch response contains a shard failure, then tag_on_failure tags are added to Logstash event
* Enhancement : add support for nested fields
* Enhancement : add 'docinfo_fields' option
* Enhancement : add 'aggregation_fields' option

*Elasticsearch Input*

* Add support for scheduling periodic execution of the query

*RabbitMQ Input/Output*

* Bug Fix: undefined method `value' for nil:NilClass with SSL enabled, but no certificates provided
* Output Only: Use shared concurrency / multiple channels for performance

*HTTP Output*

* Added json_batch format
* Make 429 responses log at debug, not error level. They are really just flow control


[[logstash-6-1-2]]
=== Logstash 6.1.2 Release Notes
* Fixed a bug that caused empty objects when cloning Logstash Timestamp instances
* Changed the way pipeline configurations are hashed to ensure consistence (not user facing)

[float]
==== Input Plugins

*`Beats`*:

* Re-order Netty pipeline to avoid NullPointerExceptions in KeepAliveHandler when Logstash is under load
* Improve exception logging
* Upgrade to Netty 4.1.18 with tcnative 2.0.7
* Better handle case when remoteAddress is nil to reduce amount of warning messages in logs

*`Jdbc`*:

* Fix thread and memory leak. See (https://github.com/logstash-plugins/logstash-input-jdbc/issues/255[#255])

*`Kafka`*:

* Upgrade Kafka client to version 1.0.0

*`S3`*:

* Add support for auto-detecting gzip files with .gzip extension, in addition to existing support for *.gz
* Improve performance of gzip decoding by 10x by using Java's Zlib
* Change default sincedb path to live in `{path.data}/plugins/inputs/s3` instead of $HOME. Prior Logstash installations (using $HOME default) are automatically migrated.
* Don't download the file if the length is 0

*`Tcp`*:

* Fix bug where codec was not flushed when client disconnected
* Restore INFO logging statement on startup
* Fixed typo in @metadata tag

[float]
==== Filter Plugins

*`Geoip`*:

* Skip lookup operation if source field contains an empty string
* Update of the GeoIP2 DB

*`Grok`*:

* Fix potential race condition. see (https://github.com/logstash-plugins/logstash-filter-grok/pull/131[#131])

[float]
==== Output Plugins

*`Kafka`*:

* bump kafka dependency to 1.0.0

[float]
==== Codecs

*`Line`*:

* Reverted thread safety fix and instead fixed udp input codec per worker. See (https://github.com/logstash-plugins/logstash-codec-line/pull/14[#14])

*`Netflow`*:

* Added support for Nokia BRAS
* Added Netflow v9 IE150 IE151, IE154, IE155

*`Plain`*:

* Code cleanup. See (https://github.com/logstash-plugins/logstash-codec-plain/pull/6[#6])

[[logstash-6-1-1]]
=== Logstash 6.1.1 Release Notes
*  There are no user-facing changes in Logstash core in this release.

[float]
==== Input Plugins

*`Beats`*:

* Fixed issue with close_wait connections to make sure that keep alive is sent back to the client. (https://github.com/logstash-plugins/logstash-input-beats/pull/272[#272])

*`HTTP`*:

* If all webserver threads are busy, the plugin now returns status code 429. (https://github.com/logstash-plugins/logstash-input-http/pull/75[#75])

*`JDBC`*:

* Fixed connection and memory leak. (https://github.com/logstash-plugins/logstash-input-jdbc/issues/251[#251])

*`Syslog`*:

* Fixed issue where stopping a pipeline with active inbound syslog connections (for example, while reloading the configuration) could cause Logstash to crash. (https://github.com/logstash-plugins/logstash-input-syslog/issues/40[#40])

[float]
==== Filter Plugins

*`Split`*:

* Fixed crash on arrays with null values. (https://github.com/logstash-plugins/logstash-filter-split#31[#31])

[float]
==== Codecs

*`Line`*:

* Fixed thread safety issue. (https://github.com/logstash-plugins/logstash-codec-line/pull/13[#13])

*`Netflow`*:

* Added vIPtela support.
* Added fields for Cisco ASR1k.


[[logstash-6-1-0]]
=== Logstash 6.1.0 Release Notes
* Implemented a new experimental Java execution engine for Logstash pipelines. The Java engine is off by default, but can be enabled with --experimental-java-execution ({lsissue}/7950[Issue 7950]).
* Added support for changing the <<configuring-persistent-queues,page capacity>> for an existing queue ({lsissue}/8628[Issue 8628]).
* Made extensive improvements to pipeline execution performance and memory efficiency ({lsissue}/7692[Issue 7692], {lsissue}/8776[8776], {lsissue}/8577[8577], {lsissue}/8446[8446], {lsissue}/8333[8333], {lsissue}/8163[8163], {lsissue}/8103[8103], {lsissue}/8087[8087], and {lsissue}/7691[7691]).

[float]
==== Filter Plugins

*`Grok`*:

* Fixed slow metric invocation and needless locking on timeout enforcer (https://github.com/logstash-plugins/logstash-filter-grok/pull/125[#125]).

*`Mutate`*:

* Added support for boolean-to-integer conversion (https://github.com/logstash-plugins/logstash-filter-mutate/pull/108[#108]).

*`Ruby`*:

* Fixed concurrency issues with multiple worker threads that was caused by a (https://github.com/jruby/jruby/issues/4868[JRuby issue]).
* Added file-based Ruby script support as an alternative to the existing inline option (https://github.com/logstash-plugins/logstash-filter-ruby/pull/35[#35]).

[float]
==== Output Plugins

*`Elasticsearch`*:

* When indexing to Elasticsearch 6.x or above, Logstash ignores the event's `type` field and no longer uses it to set the document's `_type` (https://github.com/logstash-plugins/logstash-filter-elasticsearch/pull/712[#712]).
