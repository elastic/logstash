# Generated by Chef for REDACTED
# Do NOT modify this file by hand.
#
filter {
	if [type] == "nginx-access" {  
		mutate {
			add_tag => ["nginx"]
			id => "filter_mutate_nginx-access_add_tag"
		}	  	  
		grok {
			match => { "message" => "%{NGINXACCESS}" }
			patterns_dir => [ "/etc/logstash/patterns" ]
			id => "filter_grok_nginx-access"
		}
		if "_grokparsefailure" not in [tags] {
			date {
				match => [ "timestamp", "dd/MMM/yyyy:HH:mm:ss Z" ]
				locale => "en_GB"
				timezone => "Europe/London"
				id => "filter_date_nginx-access"
			}	
			geoip {
				add_tag => [ "GeoIP_Client" ]
				source => "clientip"
				target => "geoip"
				id => "filter_geoip_nginx-access_clientip"
			}	
			mutate {
				add_field => { "clienthost" => "%{clientip}" }
				remove_field => [ "timestamp" ]
				id => "filter_mutate_nginx-access_add_clienthost"
			}	
			dns {
				action => "replace"
				reverse => [ "clienthost" ]
				id => "filter_dns_nginx-access_clienthost"
			}	
			cidr {
				add_tag => [ "host_is_ip" ]
				address => [ "%{host}" ]
				network => [ "0.0.0.0/0" ]
				id => "filter_cidr_nginx-access_host_ip"
			}
			if "host_is_ip" not in [tags] {
				dns {
					resolve => [ "host" ]
					action => "replace"
					# remove_tag => [ "host_is_ip" ]
					id => "filter_dns_nginx-access_host_ip"
				}
			}		
			mutate {
				add_field => [ "received_at", "%{@timestamp}" ]
				id => "filter_mutate_nginx-access_add_receieved_at"
			}
		}
	}
}
